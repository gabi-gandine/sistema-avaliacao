<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}">
<head>
    <title>Minhas Respostas</title>
</head>

<th:block layout:fragment="styles">
    <style>
        .resposta-card {
            border-left: 4px solid #198754;
        }
        .alternativa-selecionada {
            background-color: #d1e7dd;
            border-left: 3px solid #198754;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        .resposta-texto {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #0d6efd;
            white-space: pre-wrap;
        }
        .info-submissao {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</th:block>

<body>
    <div layout:fragment="content">
        <!-- Cabeçalho -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h2 class="mb-2">
                    <i class="bi bi-eye text-primary me-2"></i>
                    Minhas Respostas
                </h2>
                <h4 class="text-muted" th:text="${formulario.titulo}">Título do Formulário</h4>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="/aluno/formularios" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i>
                    Voltar
                </a>
                <a th:if="${podeEditar}"
                   th:href="@{/aluno/formularios/{id}/editar(id=${formulario.id})}"
                   class="btn btn-warning">
                    <i class="bi bi-pencil me-1"></i>
                    Editar
                </a>
            </div>
        </div>

        <!-- Informações da Submissão -->
        <div class="card info-submissao mb-4">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <h6 class="mb-1">
                            <i class="bi bi-calendar-check me-2"></i>
                            Data de Envio
                        </h6>
                        <p class="mb-0 fs-5" th:text="${#temporals.format(dataSubmissao, 'dd/MM/yyyy HH:mm')}">
                            01/01/2025 10:30
                        </p>
                    </div>
                    <div class="col-md-3">
                        <h6 class="mb-1">
                            <i class="bi bi-question-circle me-2"></i>
                            Total de Questões
                        </h6>
                        <p class="mb-0 fs-5" th:text="${respostas.size()}">10</p>
                    </div>
                    <div class="col-md-3">
                        <h6 class="mb-1">
                            <i class="bi bi-check-all me-2"></i>
                            Status
                        </h6>
                        <p class="mb-0">
                            <span class="badge bg-success fs-6">
                                <i class="bi bi-check-circle-fill me-1"></i>
                                Concluído
                            </span>
                        </p>
                    </div>
                    <div class="col-md-3" th:if="${podeEditar}">
                        <h6 class="mb-1">
                            <i class="bi bi-pencil me-2"></i>
                            Edição
                        </h6>
                        <p class="mb-0">
                            <span class="badge bg-warning text-dark fs-6">
                                Permitida
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Respostas -->
        <div th:each="resposta, iterStat : ${respostas}" class="mb-4">
            <div class="card resposta-card">
                <div class="card-body">
                    <!-- Questão -->
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <span class="badge bg-primary me-2" th:text="${iterStat.index + 1}">1</span>
                            <span class="fw-bold" th:text="${resposta.questao.texto}">Texto da questão?</span>
                        </div>
                        <span th:if="${resposta.questao.obrigatoria}" class="badge bg-danger">
                            Obrigatória
                        </span>
                    </div>

                    <!-- Tipo de Questão -->
                    <small class="text-muted d-block mb-3">
                        <i class="bi bi-tag me-1"></i>
                        Tipo: <span th:text="${resposta.questao.tipo.name()}">ABERTA</span>
                    </small>

                    <hr>

                    <!-- Resposta ABERTA -->
                    <div th:if="${resposta.textoResposta != null}">
                        <h6 class="text-muted mb-2">
                            <i class="bi bi-chat-left-text me-2"></i>
                            Sua Resposta:
                        </h6>
                        <div class="resposta-texto" th:text="${resposta.textoResposta}">
                            Texto da resposta...
                        </div>
                    </div>

                    <!-- Resposta MÚLTIPLA ESCOLHA -->
                    <div th:if="${resposta.alternativasSelecionadas != null and !resposta.alternativasSelecionadas.empty}">
                        <h6 class="text-muted mb-2">
                            <i class="bi bi-check-square me-2"></i>
                            Alternativa(s) Selecionada(s):
                        </h6>
                        <div th:each="alternativa : ${resposta.alternativasSelecionadas}" class="alternativa-selecionada">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <span th:text="${alternativa.textoAlternativa}">Opção selecionada</span>
                            <span th:if="${alternativa.peso != null}" class="badge bg-info ms-2">
                                Peso: <span th:text="${alternativa.peso}">5</span>
                            </span>
                        </div>

                        <!-- Mostrar todas as alternativas (não selecionadas em cinza) -->
                        <details class="mt-3">
                            <summary class="text-muted" style="cursor: pointer;">
                                <small>Ver todas as alternativas</small>
                            </summary>
                            <div class="mt-2">
                                <div th:each="alt : ${resposta.questao.alternativas}"
                                     class="py-2 px-3 mb-1 border rounded"
                                     th:classappend="${resposta.alternativasSelecionadas.contains(alt)} ? 'bg-success-subtle border-success' : 'bg-light'">
                                    <i th:if="${resposta.alternativasSelecionadas.contains(alt)}"
                                       class="bi bi-check-circle-fill text-success me-2"></i>
                                    <i th:unless="${resposta.alternativasSelecionadas.contains(alt)}"
                                       class="bi bi-circle text-muted me-2"></i>
                                    <span th:text="${alt.textoAlternativa}">Opção</span>
                                </div>
                            </div>
                        </details>
                    </div>

                    <!-- Data da Última Edição -->
                    <div th:if="${resposta.dataUltimaEdicao != null}" class="mt-3">
                        <small class="text-muted">
                            <i class="bi bi-clock-history me-1"></i>
                            Última edição: <span th:text="${#temporals.format(resposta.dataUltimaEdicao, 'dd/MM/yyyy HH:mm')}">01/01/2025 10:30</span>
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ações Finais -->
        <div class="card bg-light">
            <div class="card-body text-center">
                <p class="mb-3" th:if="${podeEditar}">
                    <i class="bi bi-info-circle text-primary me-2"></i>
                    Você pode editar suas respostas enquanto o formulário estiver aberto.
                </p>
                <p class="mb-3" th:unless="${podeEditar}">
                    <i class="bi bi-lock text-warning me-2"></i>
                    Suas respostas foram registradas e não podem mais ser editadas.
                </p>

                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <a href="/aluno/formularios" class="btn btn-outline-primary">
                        <i class="bi bi-list-check me-1"></i>
                        Ver Outros Formulários
                    </a>
                    <button onclick="window.print()" class="btn btn-outline-secondary">
                        <i class="bi bi-printer me-1"></i>
                        Imprimir Respostas
                    </button>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="scripts">
        <style media="print">
            .btn, nav, footer, .alert { display: none !important; }
            .card { border: 1px solid #ddd !important; box-shadow: none !important; }
            .info-submissao { background: #f8f9fa !important; color: #000 !important; }
        </style>
    </th:block>
</body>
</html>
